<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YugalWeather | Microclimate Tracker for Farmers</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <style>
        :root {
            --yugal-primary: #3498db;
            --yugal-secondary: #2ecc71;
            --yugal-accent: #f39c12;
            --yugal-dark: #2c3e50;
            --yugal-light: #ecf0f1;
            --yugal-success: #27ae60;
            --yugal-danger: #e74c3c;
            --yugal-warning: #f1c40f;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: #f8f9fa;
            scroll-behavior: smooth;
        }

        .navbar {
            background-color: var(--yugal-dark) !important;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .yugal-brand {
            font-weight: 700;
            color: var(--yugal-primary);
        }

        .hero-section {
            background: linear-gradient(135deg, var(--yugal-primary), var(--yugal-secondary));
            color: white;
            border-radius: 0 0 20px 20px;
            padding: 3rem 0;
            position: relative;
            overflow: hidden;
        }

        .hero-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80') center/cover no-repeat;
            opacity: 0.15;
            z-index: 0;
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .map-container {
            height: 500px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 1px solid #dee2e6;
        }

        .weather-card {
            border-left: 4px solid var(--yugal-accent);
            transition: all 0.3s;
            border-radius: 8px;
        }

        .weather-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .report-btn {
            background-color: var(--yugal-accent);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .report-btn:hover {
            transform: scale(1.1) rotate(90deg);
            background-color: #e67e22;
        }

        .severity-low {
            border-left-color: var(--yugal-success);
        }

        .severity-medium {
            border-left-color: var(--yugal-warning);
        }

        .severity-high {
            border-left-color: var(--yugal-danger);
        }

        .legend {
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .yugal-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--yugal-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.5rem;
            margin: 0 auto 15px;
        }

        .feature-card {
            border: none;
            border-radius: 10px;
            transition: all 0.3s;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .feature-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--yugal-primary);
        }

        .instruction-step {
            display: flex;
            margin-bottom: 1.5rem;
            align-items: flex-start;
        }

        .step-number {
            background-color: var(--yugal-primary);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .benefit-card {
            border: none;
            border-radius: 10px;
            padding: 1.5rem;
            background-color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: all 0.3s;
            height: 100%;
        }

        .benefit-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .benefit-icon {
            font-size: 1.75rem;
            color: var(--yugal-primary);
            margin-bottom: 1rem;
        }

        .preview-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .remove-image-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .image-preview-container {
            position: relative;
            margin-bottom: 15px;
        }

        .nav-pills .nav-link.active {
            background-color: var(--yugal-primary);
        }

        .nav-pills .nav-link {
            color: var(--yugal-dark);
        }

        @media (max-width: 768px) {
            .map-container {
                height: 350px;
            }
            
            .hero-section {
                padding: 2rem 0;
            }
            
            .display-4 {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body data-bs-spy="scroll" data-bs-target="#navbarNav">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <i class="bi bi-cloud-sun-fill me-2" style="color: var(--yugal-primary);"></i>
                <span class="yugal-brand">Yugal</span>Weather
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#map"><i class="bi bi-map me-1"></i> Live Map</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#reports"><i class="bi bi-list-ul me-1"></i> Reports</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#analytics"><i class="bi bi-graph-up me-1"></i> Analytics</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#features"><i class="bi bi-stars me-1"></i> Features</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#about"><i class="bi bi-info-circle me-1"></i> About</a>
                    </li>
                </ul>
                <button class="btn btn-outline-light ms-3 d-none d-lg-block" data-bs-toggle="modal" data-bs-target="#reportModal">
                    <i class="bi bi-plus-lg me-1"></i> Report
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container hero-content text-center">
            <h1 class="display-4 fw-bold mb-3">Field-Level Weather Intelligence</h1>
            <p class="lead mb-4">Real microclimate reports from farmers in your area</p>
            <div class="d-flex justify-content-center flex-wrap gap-2 mb-4">
                <span class="badge bg-white text-dark"><i class="bi bi-geo-alt-fill text-primary me-1"></i> Hyper-Local Data</span>
                <span class="badge bg-white text-dark"><i class="bi bi-people-fill text-success me-1"></i> Community Powered</span>
                <span class="badge bg-white text-dark"><i class="bi bi-lightning-charge-fill text-warning me-1"></i> Early Alerts</span>
            </div>
            <div class="d-flex justify-content-center gap-3">
                <a href="#features" class="btn btn-light btn-lg px-4">
                    <i class="bi bi-play-circle me-2"></i> How It Works
                </a>
                <button class="btn btn-outline-light btn-lg px-4" data-bs-toggle="modal" data-bs-target="#reportModal">
                    <i class="bi bi-plus-lg me-2"></i> Submit Report
                </button>
            </div>
        </div>
    </section>

    <!-- Quick Features -->
    <section class="py-5 bg-light">
        <div class="container">
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="feature-card card p-4 h-100">
                        <div class="feature-icon text-primary">
                            <i class="bi bi-geo"></i>
                        </div>
                        <h4>Pinpoint Accuracy</h4>
                        <p class="text-muted">See weather impacts at the field level, not just regional forecasts that often miss microclimates.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card card p-4 h-100">
                        <div class="feature-icon text-success">
                            <i class="bi bi-shield-check"></i>
                        </div>
                        <h4>Crop Protection</h4>
                        <p class="text-muted">Get early warnings about frost, floods, or droughts that could damage your crops.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card card p-4 h-100">
                        <div class="feature-icon text-warning">
                            <i class="bi bi-people"></i>
                        </div>
                        <h4>Community Network</h4>
                        <p class="text-muted">Connect with other farmers sharing real-time observations from nearby fields.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container my-5">
        <!-- Weather Map -->
        <div class="row mb-5" id="map">
            <div class="col-12">
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h4 class="mb-0"><i class="bi bi-map me-2"></i> Live Weather Impact Map</h4>
                        <div>
                            <button class="btn btn-sm btn-outline-secondary me-2" id="locateMeBtn">
                                <i class="bi bi-geo-alt"></i> Locate Me
                            </button>
                            <button class="btn btn-sm btn-outline-primary" id="refreshMapBtn">
                                <i class="bi bi-arrow-clockwise"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0 position-relative">
                        <div id="weatherMap" class="map-container"></div>
                        <div class="legend">
                            <div class="d-flex flex-column gap-1 small">
                                <div><i class="bi bi-circle-fill text-success me-1"></i> Frost Report</div>
                                <div><i class="bi bi-circle-fill text-primary me-1"></i> Flood Report</div>
                                <div><i class="bi bi-circle-fill text-warning me-1"></i> Drought Report</div>
                                <div><i class="bi bi-circle-fill text-danger me-1"></i> Storm Damage</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Weather Data -->
        <div class="row mb-5">
            <div class="col-md-6 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-cloud-sun me-2"></i> Current Conditions</h5>
                        <small class="text-muted" id="lastUpdated">Updated: Just now</small>
                    </div>
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            <div class="me-3">
                                <img src="" alt="Weather icon" id="weatherIcon" style="width: 64px; height: 64px;">
                            </div>
                            <div>
                                <h2 class="mb-0" id="currentTemp">--Â°C</h2>
                                <div id="weatherDescription">Loading weather data...</div>
                                <small class="text-muted" id="locationText">Detecting your location...</small>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-droplet me-2 text-primary"></i>
                                    <div>
                                        <small class="text-muted">Humidity</small>
                                        <div id="humidity">--%</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-wind me-2 text-info"></i>
                                    <div>
                                        <small class="text-muted">Wind</small>
                                        <div id="windSpeed">-- km/h</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-sunrise me-2 text-warning"></i>
                                    <div>
                                        <small class="text-muted">Sunrise</small>
                                        <div id="sunrise">--:--</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-sunset me-2 text-danger"></i>
                                    <div>
                                        <small class="text-muted">Sunset</small>
                                        <div id="sunset">--:--</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-header bg-white">
                        <h5 class="mb-0"><i class="bi bi-graph-up me-2"></i> 7-Day Forecast</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-borderless mb-0" id="forecastTable">
                                <thead>
                                    <tr>
                                        <th>Day</th>
                                        <th>Conditions</th>
                                        <th class="text-end">High</th>
                                        <th class="text-end">Low</th>
                                        <th class="text-end">Rain</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Forecast rows will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- How It Works -->
        <section class="row mb-5 py-4" id="features">
            <div class="col-12 mb-4 text-center">
                <h2 class="fw-bold"><i class="bi bi-stars me-2 text-primary"></i> How YugalWeather Works</h2>
                <p class="lead text-muted">Simple steps to protect your crops with community-powered weather data</p>
            </div>
            
            <div class="col-lg-6 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body">
                        <h4 class="mb-4"><i class="bi bi-list-ol me-2 text-primary"></i> Quick Start Guide</h4>
                        
                        <div class="instruction-step">
                            <div class="step-number">1</div>
                            <div>
                                <h5>Submit a Report</h5>
                                <p class="text-muted mb-0">Click the "+" button to report frost, floods, or other weather impacts in your fields. Add photos for better documentation.</p>
                            </div>
                        </div>
                        
                        <div class="instruction-step">
                            <div class="step-number">2</div>
                            <div>
                                <h5>View Local Reports</h5>
                                <p class="text-muted mb-0">Check the map for recent reports from nearby farms. Color-coded pins show different weather events.</p>
                            </div>
                        </div>
                        
                        <div class="instruction-step">
                            <div class="step-number">3</div>
                            <div>
                                <h5>Get Alerts</h5>
                                <p class="text-muted mb-0">Receive notifications when severe weather is reported near your location.</p>
                            </div>
                        </div>
                        
                        <div class="instruction-step">
                            <div class="step-number">4</div>
                            <div>
                                <h5>Plan Accordingly</h5>
                                <p class="text-muted mb-0">Use real field data to make informed decisions about irrigation, frost protection, and harvesting.</p>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-center">
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#reportModal">
                                <i class="bi bi-plus-lg me-1"></i> Submit Your First Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-6">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body">
                        <h4 class="mb-4"><i class="bi bi-award me-2 text-primary"></i> Key Benefits</h4>
                        
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="benefit-card">
                                    <div class="benefit-icon">
                                        <i class="bi bi-thermometer-snow"></i>
                                    </div>
                                    <h5>Frost Protection</h5>
                                    <p class="text-muted small">Get early warnings about temperature drops that could damage sensitive crops.</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="benefit-card">
                                    <div class="benefit-icon">
                                        <i class="bi bi-droplet"></i>
                                    </div>
                                    <h5>Flood Alerts</h5>
                                    <p class="text-muted small">See where heavy rains are causing field flooding before it reaches your land.</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="benefit-card">
                                    <div class="benefit-icon">
                                        <i class="bi bi-sun"></i>
                                    </div>
                                    <h5>Drought Monitoring</h5>
                                    <p class="text-muted small">Track soil moisture conditions across your region to optimize irrigation.</p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="benefit-card">
                                    <div class="benefit-icon">
                                        <i class="bi bi-wind"></i>
                                    </div>
                                    <h5>Storm Tracking</h5>
                                    <p class="text-muted small">Monitor wind and hail damage reports to assess potential crop impacts.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Recent Reports -->
        <div class="row mb-5" id="reports">
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h4 class="mb-0"><i class="bi bi-list-ul me-2"></i> Recent Community Reports</h4>
                        <div>
                            <button class="btn btn-sm btn-outline-secondary me-2" id="filterReportsBtn">
                                <i class="bi bi-funnel"></i> Filter
                            </button>
                            <button class="btn btn-sm btn-outline-primary" id="refreshReportsBtn">
                                <i class="bi bi-arrow-clockwise"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info mb-3">
                            <i class="bi bi-info-circle me-2"></i> These reports are submitted by farmers like you. Help your community by sharing what you're seeing in your fields.
                        </div>
                        <div id="reportsLoading" class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2 mb-0">Loading community reports...</p>
                        </div>
                        <div class="list-group" id="reportsList">
                            <!-- Reports will be inserted here -->
                        </div>
                        <div class="text-center mt-3">
                            <button class="btn btn-outline-primary" id="loadMoreReportsBtn">
                                <i class="bi bi-arrow-down-circle me-1"></i> Load More Reports
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics -->
        <div class="row mb-5" id="analytics">
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white">
                        <h4 class="mb-0"><i class="bi bi-graph-up me-2"></i> Weather Impact Analytics</h4>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-pills mb-4" id="analyticsTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="weekly-tab" data-bs-toggle="pill" data-bs-target="#weekly" type="button" role="tab">Weekly</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="monthly-tab" data-bs-toggle="pill" data-bs-target="#monthly" type="button" role="tab">Monthly</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="seasonal-tab" data-bs-toggle="pill" data-bs-target="#seasonal" type="button" role="tab">Seasonal</button>
                            </li>
                        </ul>
                        
                        <div class="tab-content" id="analyticsTabContent">
                            <div class="tab-pane fade show active" id="weekly" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="chart-container" style="position: relative; height: 300px;">
                                            <canvas id="reportsChart"></canvas>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <h6 class="text-muted mb-2">Total Reports</h6>
                                                <h3 class="mb-0" id="totalReports">0</h3>
                                                <small class="text-success"><i class="bi bi-arrow-up"></i> <span id="reportChange">0%</span> from last week</small>
                                            </div>
                                        </div>
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <h6 class="text-muted mb-2">Most Reported Issue</h6>
                                                <h5 class="mb-1" id="topIssue">--</h5>
                                                <small class="text-muted"><span id="topIssueCount">0</span> reports</small>
                                            </div>
                                        </div>
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="text-muted mb-2">Active Contributors</h6>
                                                <h5 class="mb-1" id="activeUsers">0</h5>
                                                <small class="text-muted">this week</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="monthly" role="tabpanel">
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle me-2"></i> Monthly analytics coming soon. Check back later!
                                </div>
                            </div>
                            <div class="tab-pane fade" id="seasonal" role="tabpanel">
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle me-2"></i> Seasonal trends will be available after we collect more data in your area.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- About Section -->
        <div class="row" id="about">
            <div class="col-lg-8 offset-lg-2">
                <div class="card border-0 shadow-sm">
                    <div class="card-body text-center">
                        <h2 class="mb-4"><i class="bi bi-info-circle text-primary me-2"></i> About YugalWeather</h2>
                        <p class="lead">Precision weather intelligence for agriculture and local businesses</p>
                        
                        <div class="row mt-4">
                            <div class="col-md-4 mb-4">
                                <div class="p-3">
                                    <div class="yugal-avatar">Y</div>
                                    <h5 class="mt-3">For Farmers</h5>
                                    <p class="text-muted">Get field-specific frost, flood, and drought alerts that regional forecasts miss.</p>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="p-3">
                                    <div class="yugal-avatar">W</div>
                                    <h5 class="mt-3">Community Powered</h5>
                                    <p class="text-muted">Real reports from real people in your exact area.</p>
                                </div>
                            </div>
                            <div class="col-md-4 mb-4">
                                <div class="p-3">
                                    <div class="yugal-avatar">100%</div>
                                    <h5 class="mt-3">Free Forever</h5>
                                    <p class="text-muted">No subscriptions. No paywalls. Built to serve.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h5 class="mb-3">Our Data Sources</h5>
                            <div class="d-flex flex-wrap justify-content-center gap-3">
                                <img src="https://openweathermap.org/themes/openweathermap/assets/img/logo_white_cropped.png" alt="OpenWeatherMap" style="height: 30px;">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/bd/Google_Sheets_2020_Logo.svg/1200px-Google_Sheets_2020_Logo.svg.png" alt="Google Sheets" style="height: 30px;">
                                <img src="https://leafletjs.com/docs/images/logo.png" alt="Leaflet" style="height: 30px;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Button -->
    <button class="report-btn" data-bs-toggle="modal" data-bs-target="#reportModal">
        <i class="bi bi-plus-lg"></i>
    </button>

    <!-- Report Modal -->
    <div class="modal fade" id="reportModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-cloud-upload me-2"></i> Submit Weather Report</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info mb-3">
                        <i class="bi bi-info-circle me-2"></i> Your report helps farmers in your area make better decisions. Please be accurate and detailed.
                    </div>
                    
                    <form id="weatherReportForm">
                        <div class="mb-3">
                            <label class="form-label">Weather Type <span class="text-danger">*</span></label>
                            <select class="form-select" id="reportType" required>
                                <option value="">Select weather type...</option>
                                <option value="frost">Frost</option>
                                <option value="flood">Flood</option>
                                <option value="drought">Drought</option>
                                <option value="storm">Storm Damage</option>
                                <option value="hail">Hail</option>
                                <option value="wind">High Winds</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Severity <span class="text-danger">*</span></label>
                            <select class="form-select" id="reportSeverity" required>
                                <option value="low">Low - Minor impact</option>
                                <option value="medium" selected>Medium - Moderate impact</option>
                                <option value="high">High - Severe impact</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Description <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="reportDescription" rows="3" placeholder="Describe what you're observing in your fields..." required></textarea>
                            <small class="text-muted">Example: "Unexpected frost last night damaged strawberry blossoms in northeast quadrant of field."</small>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Photo Evidence (Optional)</label>
                            <input type="file" class="form-control" id="reportPhoto" accept="image/*">
                            <small class="text-muted">Upload a photo showing the weather impact on your crops.</small>
                            <div id="imagePreview" class="mt-2"></div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Your Name (Optional)</label>
                            <input type="text" class="form-control" id="reporterName" placeholder="Farmer John">
                            <small class="text-muted">This will be displayed with your report.</small>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Location</label>
                            <div class="alert alert-info py-2">
                                <i class="bi bi-geo-alt me-2"></i> <span id="locationStatus">Detecting your location...</span>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary" id="submitReportBtn">
                                <span class="spinner-border spinner-border-sm me-2" id="submitSpinner" style="display: none;"></span>
                                <i class="bi bi-send me-2"></i> Submit Report
                            </button>
                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-5 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-4 mb-lg-0">
                    <h5 class="d-flex align-items-center mb-3">
                        <i class="bi bi-cloud-sun-fill me-2" style="color: var(--yugal-primary);"></i>
                        <span class="yugal-brand">Yugal</span>Weather
                    </h5>
                    <p class="text-muted">Precision weather for agriculture and local communities.</p>
                    <div class="d-flex gap-3 mt-3">
                        <a href="#" class="text-muted"><i class="bi bi-twitter"></i></a>
                        <a href="#" class="text-muted"><i class="bi bi-facebook"></i></a>
                        <a href="#" class="text-muted"><i class="bi bi-github"></i></a>
                    </div>
                </div>
                <div class="col-lg-2 col-md-4 mb-4 mb-md-0">
                    <h6>Navigation</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="#map" class="text-muted">Live Map</a></li>
                        <li class="mb-2"><a href="#reports" class="text-muted">Reports</a></li>
                        <li class="mb-2"><a href="#analytics" class="text-muted">Analytics</a></li>
                        <li class="mb-2"><a href="#features" class="text-muted">Features</a></li>
                        <li><a href="#about" class="text-muted">About</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-md-4 mb-4 mb-md-0">
                    <h6>Resources</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="#" class="text-muted">Help Center</a></li>
                        <li class="mb-2"><a href="#" class="text-muted">Farmers Guide</a></li>
                        <li class="mb-2"><a href="#" class="text-muted">API Docs</a></li>
                        <li><a href="#" class="text-muted">Privacy Policy</a></li>
                    </ul>
                </div>
                <div class="col-lg-4 col-md-4">
                    <h6>Subscribe to Alerts</h6>
                    <p class="text-muted small">Get email notifications for severe weather in your area.</p>
                    <form class="mt-3">
                        <div class="input-group mb-3">
                            <input type="email" class="form-control" placeholder="Your email" aria-label="Your email">
                            <button class="btn btn-primary" type="button">Subscribe</button>
                        </div>
                    </form>
                </div>
            </div>
            <hr class="my-4 bg-secondary">
            <div class="text-center">
                <small class="text-muted">&copy; 2025 YugalWeather. All weather reports are user-submitted.</small>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Configuration - Replace with your actual API keys
        const OPENWEATHER_API_KEY = 'b41ebce0340aaa233ed0433f4b17023b'; // This is a placeholder - get a real key from openweathermap.org
        const GOOGLE_SHEETS_WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbza5S5-REtVvOH8GQWuqGysymxcTrcpBcI_3tPNCTzyv9I792En0DT3n3AfYYoxxZZX/exec'; // Replace with your deployed Google Apps Script URL
        
        // Global variables
        let weatherMap;
        let userLocation = null;
        let reportsChart;
        let currentReports = [];
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the map
            initMap();
            
            // Set up event listeners
            setupEventListeners();
            
            // Get user's location and load weather data
            getUserLocation();
            
            // Load community reports
            loadCommunityReports();
            
            // Initialize analytics chart
            initAnalyticsChart();
        });
        
        function initMap() {
            // Create the map centered on a default location (will be updated when we get user's location)
            weatherMap = L.map('weatherMap').setView([51.505, -0.09], 13);
            
            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(weatherMap);
            
            // Add a marker for the user's location (will be added when location is available)
        }
        
        function setupEventListeners() {
            // Refresh reports button
            document.getElementById('refreshReportsBtn').addEventListener('click', loadCommunityReports);
            
            // Locate me button
            document.getElementById('locateMeBtn').addEventListener('click', centerMapOnUser);
            
            // Refresh map button
            document.getElementById('refreshMapBtn').addEventListener('click', refreshMapData);
            
            // Load more reports button
            document.getElementById('loadMoreReportsBtn').addEventListener('click', loadMoreReports);
            
            // Report form submission
            document.getElementById('weatherReportForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitWeatherReport();
            });
            
            // Image upload preview
            document.getElementById('reportPhoto').addEventListener('change', function(e) {
                previewImage(e.target);
            });
            
            // Modal shown event to update location status
            document.getElementById('reportModal').addEventListener('shown.bs.modal', function() {
                updateLocationStatus();
            });
        }
        
        function getUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        
                        // Update the map view
                        weatherMap.setView([userLocation.lat, userLocation.lng], 13);
                        
                        // Add a marker for the user's location
                        L.marker([userLocation.lat, userLocation.lng], {
                            icon: L.divIcon({
                                className: 'user-location-marker',
                                html: '<i class="bi bi-geo-alt-fill" style="color: #e74c3c; font-size: 24px;"></i>',
                                iconSize: [24, 24],
                                iconAnchor: [12, 24]
                            })
                        }).addTo(weatherMap)
                            .bindPopup('Your Location')
                            .openPopup();
                        
                        // Load weather data for this location
                        loadWeatherData(userLocation.lat, userLocation.lng);
                        
                        // Update location status in report modal
                        updateLocationStatus();
                    },
                    function(error) {
                        console.error('Error getting location:', error);
                        // Default to a central location if geolocation fails
                        userLocation = { lat: 51.505, lng: -0.09 };
                        loadWeatherData(userLocation.lat, userLocation.lng);
                        
                        // Update location status in report modal
                        document.getElementById('locationStatus').textContent = 'Using default location (enable location services for better accuracy)';
                    }
                );
            } else {
                console.log('Geolocation is not supported by this browser.');
                // Default to a central location
                userLocation = { lat: 51.505, lng: -0.09 };
                loadWeatherData(userLocation.lat, userLocation.lng);
                
                // Update location status in report modal
                document.getElementById('locationStatus').textContent = 'Location services not supported by your browser';
            }
        }
        
        function updateLocationStatus() {
            if (!userLocation) {
                document.getElementById('locationStatus').textContent = 'Detecting your location...';
                return;
            }
            
            // Display coordinates (in a real app, you might reverse geocode to get an address)
            document.getElementById('locationStatus').innerHTML = `
                <i class="bi bi-check-circle-fill text-success me-2"></i>
                Location detected: ${userLocation.lat.toFixed(4)}, ${userLocation.lng.toFixed(4)}
            `;
        }
        
        function centerMapOnUser() {
            if (userLocation) {
                weatherMap.setView([userLocation.lat, userLocation.lng], 13);
            } else {
                alert('Location not available. Please ensure location services are enabled.');
            }
        }
        
        function refreshMapData() {
            if (userLocation) {
                loadWeatherData(userLocation.lat, userLocation.lng);
                loadCommunityReports();
                
                // Show feedback
                const btn = document.getElementById('refreshMapBtn');
                const originalHtml = btn.innerHTML;
                btn.innerHTML = '<i class="bi bi-check2"></i> Updated';
                btn.classList.remove('btn-outline-primary');
                btn.classList.add('btn-success');
                
                setTimeout(() => {
                    btn.innerHTML = originalHtml;
                    btn.classList.remove('btn-success');
                    btn.classList.add('btn-outline-primary');
                }, 2000);
            }
        }
        
        function loadWeatherData(lat, lng) {
            // Update last updated time
            document.getElementById('lastUpdated').textContent = `Updated: ${new Date().toLocaleTimeString()}`;
            
            // Update location text
            document.getElementById('locationText').textContent = `Near ${lat.toFixed(2)}, ${lng.toFixed(2)}`;
            
            // Fetch current weather
            fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lng}&units=metric&appid=${OPENWEATHER_API_KEY}`)
                .then(response => response.json())
                .then(data => {
                    displayCurrentWeather(data);
                })
                .catch(error => {
                    console.error('Error fetching weather data:', error);
                    document.getElementById('weatherDescription').textContent = 'Weather data unavailable';
                });
            
            // Fetch forecast
            fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lng}&units=metric&appid=${OPENWEATHER_API_KEY}`)
                .then(response => response.json())
                .then(data => {
                    displayWeatherForecast(data);
                })
                .catch(error => {
                    console.error('Error fetching forecast data:', error);
                });
        }
        
        function displayCurrentWeather(data) {
            document.getElementById('currentTemp').textContent = `${Math.round(data.main.temp)}Â°C`;
            document.getElementById('weatherDescription').textContent = data.weather[0].description;
            document.getElementById('humidity').textContent = `${data.main.humidity}%`;
            document.getElementById('windSpeed').textContent = `${Math.round(data.wind.speed * 3.6)} km/h`;
            
            // Set weather icon
            const iconUrl = `https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png`;
            document.getElementById('weatherIcon').src = iconUrl;
            document.getElementById('weatherIcon').alt = data.weather[0].description;
            
            // Convert sunrise/sunset times
            const sunriseTime = new Date(data.sys.sunrise * 1000);
            const sunsetTime = new Date(data.sys.sunset * 1000);
            
            document.getElementById('sunrise').textContent = sunriseTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            document.getElementById('sunset').textContent = sunsetTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }
        
        function displayWeatherForecast(data) {
            const forecastTable = document.getElementById('forecastTable').querySelector('tbody');
            forecastTable.innerHTML = '';
            
            // We'll show one forecast per day (every 8th item in the 3-hour forecast)
            for (let i = 0; i < data.list.length; i += 8) {
                const forecast = data.list[i];
                const forecastDate = new Date(forecast.dt * 1000);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="width: 120px;">
                        <strong>${forecastDate.toLocaleDateString([], { weekday: 'short' })}</strong>
                        <div class="text-muted small">${forecastDate.toLocaleDateString([], { month: 'short', day: 'numeric' })}</div>
                    </td>
                    <td class="text-center">
                        <img src="https://openweathermap.org/img/wn/${forecast.weather[0].icon}.png" alt="${forecast.weather[0].description}" title="${forecast.weather[0].description}">
                    </td>
                    <td class="text-end">${Math.round(forecast.main.temp_max)}Â°C</td>
                    <td class="text-end">${Math.round(forecast.main.temp_min)}Â°C</td>
                    <td class="text-end">${forecast.pop > 0 ? Math.round(forecast.pop * 100) + '%' : '0%'}</td>
                `;
                
                forecastTable.appendChild(row);
            }
        }
        
        function loadCommunityReports() {
            const reportsList = document.getElementById('reportsList');
            const loadingElement = document.getElementById('reportsLoading');
            
            // Show loading state
            reportsList.innerHTML = '';
            loadingElement.style.display = 'block';
            document.getElementById('loadMoreReportsBtn').style.display = 'none';
            
            // In a real implementation, this would fetch from your Google Sheets backend
            // For this demo, we'll use mock data
            setTimeout(() => {
                currentReports = generateMockReports();
                
                // Clear existing markers except user location
                weatherMap.eachLayer(layer => {
                    if (layer instanceof L.Marker || layer instanceof L.CircleMarker) {
                        if (!layer.options.className || layer.options.className !== 'user-location-marker') {
                            weatherMap.removeLayer(layer);
                        }
                    }
                });
                
                // Display first 5 reports
                displayReports(currentReports.slice(0, 5));
                
                // Hide loading state
                loadingElement.style.display = 'none';
                
                // Show load more button if there are more reports
                if (currentReports.length > 5) {
                    document.getElementById('loadMoreReportsBtn').style.display = 'inline-block';
                }
                
                // Update analytics
                updateAnalytics(currentReports);
            }, 1000);
        }
        
        function loadMoreReports() {
            const reportsList = document.getElementById('reportsList');
            const currentlyDisplayed = reportsList.children.length;
            
            // Display next 5 reports
            displayReports(currentReports.slice(currentlyDisplayed, currentlyDisplayed + 5));
            
            // Hide load more button if we've shown all reports
            if (reportsList.children.length >= currentReports.length) {
                document.getElementById('loadMoreReportsBtn').style.display = 'none';
            }
        }
        
        function displayReports(reports) {
            const reportsList = document.getElementById('reportsList');
            
            reports.forEach(report => {
                // Add to list
                const reportElement = document.createElement('a');
                reportElement.href = '#';
                reportElement.className = 'list-group-item list-group-item-action';
                
                let severityClass = '';
                let severityIcon = '';
                let severityText = '';
                
                switch(report.severity) {
                    case 'low':
                        severityClass = 'severity-low';
                        severityIcon = 'bi-exclamation-circle text-success';
                        severityText = 'Low Severity';
                        break;
                    case 'medium':
                        severityClass = 'severity-medium';
                        severityIcon = 'bi-exclamation-triangle text-warning';
                        severityText = 'Medium Severity';
                        break;
                    case 'high':
                        severityClass = 'severity-high';
                        severityIcon = 'bi-exclamation-octagon text-danger';
                        severityText = 'High Severity';
                        break;
                }
                
                const reportDate = new Date(report.date);
                const timeAgo = getTimeAgo(reportDate);
                
                reportElement.innerHTML = `
                    <div class="d-flex w-100 justify-content-between ${severityClass}">
                        <div>
                            <div class="d-flex align-items-center mb-1">
                                <h6 class="mb-0 text-capitalize">${report.type}</h6>
                                <span class="badge bg-light text-dark ms-2"><i class="bi ${severityIcon} me-1"></i> ${severityText}</span>
                            </div>
                            <p class="mb-1">${report.description}</p>
                            ${report.image ? `<img src="${report.image}" class="preview-image mb-2" style="max-width: 150px;">` : ''}
                            <small class="text-muted">Reported by ${report.reporter}</small>
                        </div>
                        <div class="text-end">
                            <small class="text-muted d-block">${timeAgo}</small>
                            <small class="text-muted d-block">${report.distance} km away</small>
                        </div>
                    </div>
                `;
                
                reportsList.appendChild(reportElement);
                
                // Add to map
                let markerColor;
                switch(report.type) {
                    case 'frost': markerColor = '#2ecc71'; break;
                    case 'flood': markerColor = '#3498db'; break;
                    case 'drought': markerColor = '#f39c12'; break;
                    case 'storm': markerColor = '#e74c3c'; break;
                    case 'hail': markerColor = '#9b59b6'; break;
                    default: markerColor = '#34495e';
                }
                
                const marker = L.circleMarker([report.lat, report.lng], {
                    radius: 8,
                    fillColor: markerColor,
                    color: '#fff',
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8
                }).addTo(weatherMap);
                
                let popupContent = `
                    <b>${report.type.toUpperCase()} REPORT</b><br>
                    <small>${reportDate.toLocaleString()}</small><br><br>
                    <i>${report.description}</i><br><br>
                    <small>Severity: ${report.severity}</small><br>
                    <small>Reported by: ${report.reporter}</small>
                `;
                
                if (report.image) {
                    popupContent += `<br><img src="${report.image}" style="max-width: 150px; margin-top: 10px;">`;
                }
                
                marker.bindPopup(popupContent);
            });
        }
        
        function generateMockReports() {
            if (!userLocation) return [];
            
            const reportTypes = ['frost', 'flood', 'drought', 'storm', 'hail', 'wind'];
            const reporters = ['Farm Fresh Co.', 'River Valley Farms', 'Sunny Acres', 'Green Thumb Nursery', 'Organic Valley', 'Heritage Farms'];
            const severities = ['low', 'medium', 'high'];
            const descriptions = [
                'Unexpected frost damaged early strawberry blossoms',
                'Heavy rains caused field flooding in low-lying areas',
                'Soil moisture levels dropping faster than usual',
                'Hail storm damaged greenhouse structures',
                'High winds knocked down corn plants in north field',
                'Extended dry period stressing young plants'
            ];
            
            const mockImages = [
                'https://images.unsplash.com/photo-1518604666860-9ed391f76460?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80',
                'https://images.unsplash.com/photo-1560264281-4b7b7d872f58?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80',
                'https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80'
            ];
            
            const mockReports = [];
            const now = new Date();
            
            for (let i = 0; i < 15; i++) {
                const type = reportTypes[Math.floor(Math.random() * reportTypes.length)];
                const severity = severities[Math.floor(Math.random() * severities.length)];
                const reporter = reporters[Math.floor(Math.random() * reporters.length)];
                const description = descriptions[Math.floor(Math.random() * descriptions.length)];
                
                // Generate random location near user (within 50km)
                const lat = userLocation.lat + (Math.random() * 0.5 - 0.25);
                const lng = userLocation.lng + (Math.random() * 0.5 - 0.25);
                
                // Calculate distance from user
                const distance = calculateDistance(userLocation.lat, userLocation.lng, lat, lng);
                
                // Random date in past 7 days
                const date = new Date(now - Math.random() * 7 * 24 * 60 * 60 * 1000);
                
                mockReports.push({
                    id: i + 1,
                    type,
                    severity,
                    description,
                    reporter,
                    date: date.toISOString(),
                    lat,
                    lng,
                    distance: distance.toFixed(1),
                    image: Math.random() > 0.7 ? mockImages[Math.floor(Math.random() * mockImages.length)] : null
                });
            }
            
            // Sort by date (newest first)
            return mockReports.sort((a, b) => new Date(b.date) - new Date(a.date));
        }
        
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radius of the earth in km
            const dLat = deg2rad(lat2 - lat1);
            const dLon = deg2rad(lon2 - lon1); 
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * 
                Math.sin(dLon/2) * Math.sin(dLon/2); 
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
            return R * c; // Distance in km
        }
        
        function deg2rad(deg) {
            return deg * (Math.PI/180);
        }
        
        function submitWeatherReport() {
            if (!userLocation) {
                alert('Please enable location services to submit a report.');
                return;
            }
            
            const submitBtn = document.getElementById('submitReportBtn');
            const spinner = document.getElementById('submitSpinner');
            const form = document.getElementById('weatherReportForm');
            
            // Show loading state
            submitBtn.disabled = true;
            spinner.style.display = 'inline-block';
            
            // Get form data
            const reportData = {
                type: document.getElementById('reportType').value,
                severity: document.getElementById('reportSeverity').value,
                description: document.getElementById('reportDescription').value,
                reporter: document.getElementById('reporterName').value || 'Anonymous',
                lat: userLocation.lat,
                lng: userLocation.lng,
                timestamp: new Date().toISOString()
            };
            
            // Handle image upload if present
            const imageInput = document.getElementById('reportPhoto');
            let imageFile = null;
            
            if (imageInput.files.length > 0) {
                imageFile = imageInput.files[0];
                
                // In a real implementation, you would upload this to your server or cloud storage
                // For this demo, we'll just add it to the report data as a mock URL
                reportData.image = 'https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80';
            }
            
            // In a real implementation, this would POST to your Google Apps Script web app
            console.log('Submitting report:', reportData);
            
            // Prepare FormData for actual submission (commented out for demo)
            /*
            const formData = new FormData();
            formData.append('type', reportData.type);
            formData.append('severity', reportData.severity);
            formData.append('description', reportData.description);
            formData.append('reporter', reportData.reporter);
            formData.append('lat', reportData.lat);
            formData.append('lng', reportData.lng);
            formData.append('timestamp', reportData.timestamp);
            if (imageFile) formData.append('image', imageFile);
            
            fetch(GOOGLE_SHEETS_WEBAPP_URL, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                // Handle success
                submitBtn.disabled = false;
                spinner.style.display = 'none';
                
                alert('Thank you for your report! This helps your community stay informed.');
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('reportModal'));
                modal.hide();
                
                // Refresh reports
                loadCommunityReports();
                
                // Reset form
                form.reset();
                document.getElementById('imagePreview').innerHTML = '';
            })
            .catch(error => {
                console.error('Error submitting report:', error);
                submitBtn.disabled = false;
                spinner.style.display = 'none';
                alert('Error submitting report. Please try again.');
            });
            */
            
            // Simulate API call delay for demo
            setTimeout(() => {
                // Hide loading state
                submitBtn.disabled = false;
                spinner.style.display = 'none';
                
                // Show success message
                alert('Thank you for your report! This helps your community stay informed.');
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('reportModal'));
                modal.hide();
                
                // Refresh reports
                loadCommunityReports();
                
                // Reset form
                form.reset();
                document.getElementById('imagePreview').innerHTML = '';
            }, 1500);
        }
        
        function previewImage(input) {
            const previewContainer = document.getElementById('imagePreview');
            previewContainer.innerHTML = '';
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const previewDiv = document.createElement('div');
                    previewDiv.className = 'image-preview-container';
                    previewDiv.innerHTML = `
                        <img src="${e.target.result}" class="preview-image">
                        <button type="button" class="remove-image-btn" onclick="removeImagePreview()">
                            <i class="bi bi-x"></i>
                        </button>
                    `;
                    previewContainer.appendChild(previewDiv);
                };
                
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        function removeImagePreview() {
            document.getElementById('reportPhoto').value = '';
            document.getElementById('imagePreview').innerHTML = '';
        }
        
        function initAnalyticsChart() {
            const ctx = document.getElementById('reportsChart').getContext('2d');
            
            reportsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Frost', 'Flood', 'Drought', 'Storm', 'Hail', 'Other'],
                    datasets: [{
                        label: 'Reports Last 7 Days',
                        data: [0, 0, 0, 0, 0, 0],
                        backgroundColor: [
                            '#2ecc71',
                            '#3498db',
                            '#f39c12',
                            '#e74c3c',
                            '#9b59b6',
                            '#34495e'
                        ],
                        borderColor: [
                            '#27ae60',
                            '#2980b9',
                            '#e67e22',
                            '#c0392b',
                            '#8e44ad',
                            '#2c3e50'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.raw}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
        }
        
        function updateAnalytics(reports) {
            // Update report counts
            document.getElementById('totalReports').textContent = reports.length;
            document.getElementById('reportChange').textContent = `${Math.floor(Math.random() * 30) + 5}%`;
            
            // Find most reported issue
            const issueCounts = {};
            reports.forEach(report => {
                issueCounts[report.type] = (issueCounts[report.type] || 0) + 1;
            });
            
            let topIssue = '';
            let topCount = 0;
            
            for (const [issue, count] of Object.entries(issueCounts)) {
                if (count > topCount) {
                    topIssue = issue;
                    topCount = count;
                }
            }
            
            document.getElementById('topIssue').textContent = topIssue.charAt(0).toUpperCase() + topIssue.slice(1);
            document.getElementById('topIssueCount').textContent = topCount;
            
            // Update active users
            const uniqueReporters = new Set(reports.map(r => r.reporter));
            document.getElementById('activeUsers').textContent = uniqueReporters.size;
            
            // Update chart data
            if (reportsChart) {
                reportsChart.data.datasets[0].data = [
                    reports.filter(r => r.type === 'frost').length,
                    reports.filter(r => r.type === 'flood').length,
                    reports.filter(r => r.type === 'drought').length,
                    reports.filter(r => r.type === 'storm').length,
                    reports.filter(r => r.type === 'hail').length,
                    reports.filter(r => r.type === 'other' || r.type === 'wind').length
                ];
                reportsChart.update();
            }
        }
        
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            let interval = Math.floor(seconds / 31536000);
            if (interval >= 1) return `${interval} year${interval === 1 ? '' : 's'} ago`;
            
            interval = Math.floor(seconds / 2592000);
            if (interval >= 1) return `${interval} month${interval === 1 ? '' : 's'} ago`;
            
            interval = Math.floor(seconds / 86400);
            if (interval >= 1) return `${interval} day${interval === 1 ? '' : 's'} ago`;
            
            interval = Math.floor(seconds / 3600);
            if (interval >= 1) return `${interval} hour${interval === 1 ? '' : 's'} ago`;
            
            interval = Math.floor(seconds / 60);
            if (interval >= 1) return `${interval} minute${interval === 1 ? '' : 's'} ago`;
            
            return 'Just now';
        }
        
        // Make removeImagePreview available globally
        window.removeImagePreview = removeImagePreview;
    </script>
</body>
</html>
