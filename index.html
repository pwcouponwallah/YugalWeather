<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriPredict | AI-Powered Crop Yield Optimization</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <style>
        :root {
            --agripredict-primary: #2c5aa0;
            --agripredict-secondary: #4caf50;
            --agripredict-accent: #ff9800;
            --agripredict-dark: #1e3c72;
            --agripredict-light: #f5f9ff;
            --agripredict-success: #66bb6a;
            --agripredict-danger: #ef5350;
            --agripredict-warning: #ffa726;
            --agripredict-info: #42a5f5;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: #f8f9fa;
            scroll-behavior: smooth;
        }

        .navbar {
            background: linear-gradient(135deg, var(--agripredict-dark), var(--agripredict-primary)) !important;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .agripredict-brand {
            font-weight: 700;
            color: white;
        }

        .hero-section {
            background: linear-gradient(135deg, var(--agripredict-primary), var(--agripredict-secondary));
            color: white;
            border-radius: 0 0 20px 20px;
            padding: 3rem 0;
            position: relative;
            overflow: hidden;
        }

        .hero-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80') center/cover no-repeat;
            opacity: 0.15;
            z-index: 0;
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .map-container {
            height: 500px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 1px solid #dee2e6;
        }

        .weather-card {
            border-left: 4px solid var(--agripredict-accent);
            transition: all 0.3s;
            border-radius: 8px;
        }

        .weather-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .report-btn {
            background-color: var(--agripredict-accent);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .report-btn:hover {
            transform: scale(1.1) rotate(90deg);
            background-color: #f57c00;
        }

        .severity-low {
            border-left-color: var(--agripredict-success);
        }

        .severity-medium {
            border-left-color: var(--agripredict-warning);
        }

        .severity-high {
            border-left-color: var(--agripredict-danger);
        }

        .legend {
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .agripredict-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--agripredict-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.5rem;
            margin: 0 auto 15px;
        }

        .feature-card {
            border: none;
            border-radius: 10px;
            transition: all 0.3s;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .feature-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--agripredict-primary);
        }

        .instruction-step {
            display: flex;
            margin-bottom: 1.5rem;
            align-items: flex-start;
        }

        .step-number {
            background-color: var(--agripredict-primary);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .benefit-card {
            border: none;
            border-radius: 10px;
            padding: 1.5rem;
            background-color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: all 0.3s;
            height: 100%;
        }

        .benefit-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .benefit-icon {
            font-size: 1.75rem;
            color: var(--agripredict-primary);
            margin-bottom: 1rem;
        }

        .preview-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .remove-image-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .image-preview-container {
            position: relative;
            margin-bottom: 15px;
        }

        .nav-pills .nav-link.active {
            background-color: var(--agripredict-primary);
        }

        .nav-pills .nav-link {
            color: var(--agripredict-dark);
        }

        .prediction-card {
            background: linear-gradient(135deg, #f5f9ff, #e3f2fd);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .crop-selector {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .crop-option {
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .crop-option:hover {
            background-color: #e8f5e9;
        }

        .crop-option.active {
            background-color: var(--agripredict-primary);
            color: white;
        }

        .crop-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .prediction-result {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .yield-meter {
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .yield-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #4caf50);
            border-radius: 10px;
            transition: width 0.5s ease-in-out;
        }

        .optimization-tip {
            background-color: #e8f5e9;
            border-left: 4px solid var(--agripredict-success);
            padding: 1rem;
            border-radius: 0 8px 8px 0;
            margin-bottom: 1rem;
        }

        .language-selector {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 1000;
        }

        @media (max-width: 768px) {
            .map-container {
                height: 350px;
            }
            
            .hero-section {
                padding: 2rem 0;
            }
            
            .display-4 {
                font-size: 2.5rem;
            }
            
            .language-selector {
                position: relative;
                top: 0;
                right: 0;
                margin-bottom: 1rem;
            }
        }

        /* Animation for predictions */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse-animation {
            animation: pulse 2s infinite;
        }

        /* Dark mode support */
        .dark-mode {
            background-color: #1a1a1a;
            color: #f0f0f0;
        }

        .dark-mode .card {
            background-color: #2d2d2d;
            color: #f0f0f0;
        }

        .dark-mode .text-muted {
            color: #a0a0a0 !important;
        }
    </style>
</head>
<body data-bs-spy="scroll" data-bs-target="#navbarNav">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <i class="bi bi-cloud-sun-fill me-2"></i>
                <span class="agripredict-brand">AgriPredict</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#map"><i class="bi bi-map me-1"></i> Field Map</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#predict"><i class="bi bi-graph-up me-1"></i> Yield Prediction</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#reports"><i class="bi bi-list-ul me-1"></i> Reports</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#analytics"><i class="bi bi-bar-chart me-1"></i> Analytics</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#optimization"><i class="bi bi-lightbulb me-1"></i> Optimization</a>
                    </li>
                </ul>
                <button class="btn btn-outline-light ms-3 d-none d-lg-block" data-bs-toggle="modal" data-bs-target="#reportModal">
                    <i class="bi bi-plus-lg me-1"></i> Report
                </button>
            </div>
        </div>
    </nav>

    <!-- Language Selector -->
    <div class="language-selector">
        <select class="form-select form-select-sm" id="languageSelector">
            <option value="en">English</option>
            <option value="or">Odia</option>
            <option value="hi">Hindi</option>
            <option value="te">Telugu</option>
        </select>
    </div>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container hero-content text-center">
            <h1 class="display-4 fw-bold mb-3">AI-Powered Crop Yield Prediction</h1>
            <p class="lead mb-4">Maximize your harvest with data-driven insights and field-level intelligence</p>
            <div class="d-flex justify-content-center flex-wrap gap-2 mb-4">
                <span class="badge bg-white text-dark"><i class="bi bi-robot text-primary me-1"></i> AI Predictions</span>
                <span class="badge bg-white text-dark"><i class="bi bi-droplet text-info me-1"></i> Irrigation Optimization</span>
                <span class="badge bg-white text-dark"><i class="bi bi-shield-check text-success me-1"></i> Pest Management</span>
            </div>
            <div class="d-flex justify-content-center gap-3 flex-wrap">
                <a href="#predict" class="btn btn-light btn-lg px-4">
                    <i class="bi bi-graph-up me-2"></i> Predict Yield
                </a>
                <button class="btn btn-outline-light btn-lg px-4" data-bs-toggle="modal" data-bs-target="#reportModal">
                    <i class="bi bi-plus-lg me-2"></i> Field Report
                </button>
            </div>
        </div>
    </section>

    <!-- Quick Features -->
    <section class="py-5 bg-light">
        <div class="container">
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="feature-card card p-4 h-100">
                        <div class="feature-icon text-primary">
                            <i class="bi bi-robot"></i>
                        </div>
                        <h4>AI Yield Prediction</h4>
                        <p class="text-muted">Advanced machine learning models predict crop yields based on weather, soil, and historical data.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card card p-4 h-100">
                        <div class="feature-icon text-success">
                            <i class="bi bi-droplet"></i>
                        </div>
                        <h4>Irrigation Optimization</h4>
                        <p class="text-muted">Smart water management recommendations to reduce waste and improve crop health.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card card p-4 h-100">
                        <div class="feature-icon text-warning">
                            <i class="bi bi-bug"></i>
                        </div>
                        <h4>Pest & Disease Alerts</h4>
                        <p class="text-muted">Early warning system for potential pest outbreaks and disease risks in your area.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container my-5">
        <!-- Yield Prediction Section -->
        <div class="row mb-5" id="predict">
            <div class="col-12">
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white">
                        <h4 class="mb-0"><i class="bi bi-graph-up me-2"></i> Crop Yield Prediction</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-5">
                                <div class="prediction-card">
                                    <h5 class="mb-3">Select Your Crop</h5>
                                    <div class="row g-2 crop-selector">
                                        <div class="col-4">
                                            <div class="crop-option active" data-crop="rice">
                                                <div class="crop-icon"><i class="bi bi-tree"></i></div>
                                                <div>Rice</div>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="crop-option" data-crop="wheat">
                                                <div class="crop-icon"><i class="bi bi-tree"></i></div>
                                                <div>Wheat</div>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="crop-option" data-crop="corn">
                                                <div class="crop-icon"><i class="bi bi-tree"></i></div>
                                                <div>Corn</div>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="crop-option" data-crop="sugarcane">
                                                <div class="crop-icon"><i class="bi bi-tree"></i></div>
                                                <div>Sugarcane</div>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="crop-option" data-crop="cotton">
                                                <div class="crop-icon"><i class="bi bi-tree"></i></div>
                                                <div>Cotton</div>
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="crop-option" data-crop="pulses">
                                                <div class="crop-icon"><i class="bi bi-tree"></i></div>
                                                <div>Pulses</div>
                                            </div>
                                        </div>
                                    </div>

                                    <h5 class="mt-4 mb-3">Field Information</h5>
                                    <div class="mb-3">
                                        <label class="form-label">Field Area (acres)</label>
                                        <input type="number" class="form-control" id="fieldArea" value="5" min="1" max="1000">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Soil Type</label>
                                        <select class="form-select" id="soilType">
                                            <option value="loamy">Loamy</option>
                                            <option value="clay">Clay</option>
                                            <option value="sandy">Sandy</option>
                                            <option value="silt">Silt</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Irrigation Type</label>
                                        <select class="form-select" id="irrigationType">
                                            <option value="drip">Drip Irrigation</option>
                                            <option value="sprinkler">Sprinkler</option>
                                            <option value="flood">Flood</option>
                                            <option value="rainfed">Rainfed</option>
                                        </select>
                                    </div>
                                    <button class="btn btn-primary w-100" id="predictYieldBtn">
                                        <i class="bi bi-calculator me-2"></i> Predict Yield
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-7">
                                <div class="prediction-result">
                                    <h5 class="mb-3">Yield Prediction for <span id="selectedCrop">Rice</span></h5>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Predicted Yield</span>
                                        <strong id="yieldValue">4.2 tons/acre</strong>
                                    </div>
                                    <div class="yield-meter">
                                        <div class="yield-fill" style="width: 70%"></div>
                                    </div>
                                    <div class="d-flex justify-content-between mb-4">
                                        <small>Low</small>
                                        <small>High</small>
                                    </div>

                                    <h6 class="mb-3">Optimization Recommendations</h6>
                                    <div class="optimization-tip">
                                        <i class="bi bi-lightbulb me-2"></i> Increase phosphorus-based fertilizer by 15% during growth stage
                                    </div>
                                    <div class="optimization-tip">
                                        <i class="bi bi-droplet me-2"></i> Adjust irrigation schedule to 3-day intervals instead of 5-day
                                    </div>
                                    <div class="optimization-tip">
                                        <i class="bi bi-shield me-2"></i> Apply neem-based pesticide in next 7 days to prevent leaf folder
                                    </div>

                                    <div class="mt-4">
                                        <h6>Expected Profit Calculation</h6>
                                        <div class="row">
                                            <div class="col-6">
                                                <div class="card bg-light mb-2">
                                                    <div class="card-body py-2">
                                                        <small>Total Yield</small>
                                                        <h6 class="mb-0" id="totalYield">21 tons</h6>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="card bg-light mb-2">
                                                    <div class="card-body py-2">
                                                        <small>Expected Revenue</small>
                                                        <h6 class="mb-0" id="expectedRevenue">₹1,05,000</h6>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Weather Map -->
        <div class="row mb-5" id="map">
            <div class="col-12">
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h4 class="mb-0"><i class="bi bi-map me-2"></i> Field Conditions Map</h4>
                        <div>
                            <button class="btn btn-sm btn-outline-secondary me-2" id="locateMeBtn">
                                <i class="bi bi-geo-alt"></i> Locate Me
                            </button>
                            <button class="btn btn-sm btn-outline-primary" id="refreshMapBtn">
                                <i class="bi bi-arrow-clockwise"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0 position-relative">
                        <div id="weatherMap" class="map-container"></div>
                        <div class="legend">
                            <div class="d-flex flex-column gap-1 small">
                                <div><i class="bi bi-circle-fill text-success me-1"></i> Optimal Conditions</div>
                                <div><i class="bi bi-circle-fill text-warning me-1"></i> Needs Attention</div>
                                <div><i class="bi bi-circle-fill text-danger me-1"></i> Critical Issues</div>
                                <div><i class="bi bi-circle-fill text-primary me-1"></i> Your Fields</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Weather Data -->
        <div class="row mb-5">
            <div class="col-md-6 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-cloud-sun me-2"></i> Current Conditions</h5>
                        <small class="text-muted" id="lastUpdated">Updated: Just now</small>
                    </div>
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            <div class="me-3">
                                <img src="" alt="Weather icon" id="weatherIcon" style="width: 64px; height: 64px;">
                            </div>
                            <div>
                                <h2 class="mb-0" id="currentTemp">--°C</h2>
                                <div id="weatherDescription">Loading weather data...</div>
                                <small class="text-muted" id="locationText">Detecting your location...</small>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-droplet me-2 text-primary"></i>
                                    <div>
                                        <small class="text-muted">Humidity</small>
                                        <div id="humidity">--%</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-wind me-2 text-info"></i>
                                    <div>
                                        <small class="text-muted">Wind</small>
                                        <div id="windSpeed">-- km/h</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-sunrise me-2 text-warning"></i>
                                    <div>
                                        <small class="text-muted">Sunrise</small>
                                        <div id="sunrise">--:--</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-sunset me-2 text-danger"></i>
                                    <div>
                                        <small class="text-muted">Sunset</small>
                                        <div id="sunset">--:--</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-moisture me-2 text-success"></i>
                                    <div>
                                        <small class="text-muted">Soil Moisture</small>
                                        <div id="soilMoisture">--%</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-thermometer-half me-2 text-danger"></i>
                                    <div>
                                        <small class="text-muted">Soil Temp</small>
                                        <div id="soilTemp">--°C</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-header bg-white">
                        <h5 class="mb-0"><i class="bi bi-graph-up me-2"></i> 7-Day Forecast</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-borderless mb-0" id="forecastTable">
                                <thead>
                                    <tr>
                                        <th>Day</th>
                                        <th>Conditions</th>
                                        <th class="text-end">High</th>
                                        <th class="text-end">Low</th>
                                        <th class="text-end">Rain</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Forecast rows will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Optimization Section -->
        <div class="row mb-5" id="optimization">
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white">
                        <h4 class="mb-0"><i class="bi bi-lightbulb me-2"></i> Farming Optimization</h4>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-pills mb-4" id="optimizationTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="irrigation-tab" data-bs-toggle="pill" data-bs-target="#irrigation" type="button" role="tab">Irrigation</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="fertilizer-tab" data-bs-toggle="pill" data-bs-target="#fertilizer" type="button" role="tab">Fertilizer</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="pest-tab" data-bs-toggle="pill" data-bs-target="#pest" type="button" role="tab">Pest Control</button>
                            </li>
                        </ul>
                        
                        <div class="tab-content" id="optimizationTabContent">
                            <div class="tab-pane fade show active" id="irrigation" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-8">
                                        <h5>Irrigation Schedule</h5>
                                        <p>Based on current soil moisture and weather forecast, here's your optimized irrigation plan:</p>
                                        
                                        <div class="table-responsive">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                        <th>Date</th>
                                                        <th>Time</th>
                                                        <th>Duration</th>
                                                        <th>Water Amount</th>
                                                        <th>Status</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>Today</td>
                                                        <td>06:00 AM</td>
                                                        <td>45 minutes</td>
                                                        <td>1200 liters</td>
                                                        <td><span class="badge bg-success">Completed</span></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Tomorrow</td>
                                                        <td>06:30 AM</td>
                                                        <td>60 minutes</td>
                                                        <td>1500 liters</td>
                                                        <td><span class="badge bg-info">Scheduled</span></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Aug 15</td>
                                                        <td>07:00 AM</td>
                                                        <td>30 minutes</td>
                                                        <td>900 liters</td>
                                                        <td><span class="badge bg-secondary">Upcoming</span></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card bg-light">
                                            <div class="card-body">
                                                <h6>Water Savings</h6>
                                                <div class="d-flex align-items-center mb-3">
                                                    <div class="bg-primary text-white rounded-circle p-3 me-3">
                                                        <i class="bi bi-droplet fs-4"></i>
                                                    </div>
                                                    <div>
                                                        <h4 class="mb-0">32%</h4>
                                                        <small class="text-muted">Compared to traditional methods</small>
                                                    </div>
                                                </div>
                                                <div class="progress mb-2">
                                                    <div class="progress-bar" role="progressbar" style="width: 32%" aria-valuenow="32" aria-valuemin="0" aria-valuemax="100"></div>
                                                </div>
                                                <small>Estimated monthly savings: <strong>15,000 liters</strong></small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="fertilizer" role="tabpanel">
                                <h5>Fertilizer Recommendations</h5>
                                <p>Based on soil analysis and crop requirements, here are your fertilizer recommendations:</p>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between">
                                                    <h6>Nitrogen (N)</h6>
                                                    <span class="badge bg-warning">Medium</span>
                                                </div>
                                                <div class="progress mb-2">
                                                    <div class="progress-bar bg-success" role="progressbar" style="width: 65%" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100"></div>
                                                </div>
                                                <small>Apply 15kg/acre of urea in next 7 days</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between">
                                                    <h6>Phosphorus (P)</h6>
                                                    <span class="badge bg-danger">Low</span>
                                                </div>
                                                <div class="progress mb-2">
                                                    <div class="progress-bar bg-info" role="progressbar" style="width: 30%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100"></div>
                                                </div>
                                                <small>Apply 20kg/acre of DAP immediately</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between">
                                                    <h6>Potassium (K)</h6>
                                                    <span class="badge bg-success">Optimal</span>
                                                </div>
                                                <div class="progress mb-2">
                                                    <div class="progress-bar bg-warning" role="progressbar" style="width: 80%" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
                                                </div>
                                                <small>No additional potassium needed at this time</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between">
                                                    <h6>Organic Matter</h6>
                                                    <span class="badge bg-info">Good</span>
                                                </div>
                                                <div class="progress mb-2">
                                                    <div class="progress-bar" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                                                </div>
                                                <small>Add 2 tons/acre of compost during next plowing</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="pest" role="tabpanel">
                                <h5>Pest & Disease Management</h5>
                                <p>Based on regional data and crop stage, here are potential risks and preventive measures:</p>
                                
                                <div class="alert alert-warning">
                                    <i class="bi bi-exclamation-triangle me-2"></i> High alert for Brown Plant Hopper in your area. Monitor fields closely.
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <h6 class="mb-0">Brown Plant Hopper</h6>
                                                    <span class="badge bg-danger">High Risk</span>
                                                </div>
                                                <p class="small mb-2">Likely to affect crops in next 10-14 days based on weather conditions.</p>
                                                <div>
                                                    <strong>Prevention:</strong> Apply Imidacloprid 17.8% SL @ 50 ml/acre
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <h6 class="mb-0">Leaf Blast</h6>
                                                    <span class="badge bg-warning">Medium Risk</span>
                                                </div>
                                                <p class="small mb-2">Possible outbreak due to recent humidity levels and temperature fluctuations.</p>
                                                <div>
                                                    <strong>Prevention:</strong> Apply Tricyclazole 75% WP @ 30g/acre
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <h6 class="mb-0">Stem Borer</h6>
                                                    <span class="badge bg-success">Low Risk</span>
                                                </div>
                                                <p class="small mb-2">Currently low activity in your region. Continue monitoring.</p>
                                                <div>
                                                    <strong>Prevention:</strong> Use pheromone traps @ 5/acre
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <h6 class="mb-0">Bacterial Blight</h6>
                                                    <span class="badge bg-info">Minimal Risk</span>
                                                </div>
                                                <p class="small mb-2">Conditions not favorable for outbreak at this time.</p>
                                                <div>
                                                    <strong>Prevention:</strong> Maintain proper water level and drainage
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Reports -->
        <div class="row mb-5" id="reports">
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h4 class="mb-0"><i class="bi bi-list-ul me-2"></i> Field Reports</h4>
                        <div>
                            <button class="btn btn-sm btn-outline-secondary me-2" id="filterReportsBtn">
                                <i class="bi bi-funnel"></i> Filter
                            </button>
                            <button class="btn btn-sm btn-outline-primary" id="refreshReportsBtn">
                                <i class="bi bi-arrow-clockwise"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info mb-3">
                            <i class="bi bi-info-circle me-2"></i> These reports are submitted by farmers in your area. Help your community by sharing your observations.
                        </div>
                        <div id="reportsLoading" class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2 mb-0">Loading field reports...</p>
                        </div>
                        <div class="list-group" id="reportsList">
                            <!-- Reports will be inserted here -->
                        </div>
                        <div class="text-center mt-3">
                            <button class="btn btn-outline-primary" id="loadMoreReportsBtn">
                                <i class="bi bi-arrow-down-circle me-1"></i> Load More Reports
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics -->
        <div class="row mb-5" id="analytics">
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white">
                        <h4 class="mb-0"><i class="bi bi-bar-chart me-2"></i> Farm Analytics</h4>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-pills mb-4" id="analyticsTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="yield-tab" data-bs-toggle="pill" data-bs-target="#yield" type="button" role="tab">Yield Trends</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="cost-tab" data-bs-toggle="pill" data-bs-target="#cost" type="button" role="tab">Cost Analysis</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="comparison-tab" data-bs-toggle="pill" data-bs-target="#comparison" type="button" role="tab">Regional Comparison</button>
                            </li>
                        </ul>
                        
                        <div class="tab-content" id="analyticsTabContent">
                            <div class="tab-pane fade show active" id="yield" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="chart-container" style="position: relative; height: 300px;">
                                            <canvas id="yieldChart"></canvas>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <h6 class="text-muted mb-2">Estimated Yield Increase</h6>
                                                <h3 class="mb-0" id="yieldIncrease">12.5%</h3>
                                                <small class="text-success"><i class="bi bi-arrow-up"></i> With recommended practices</small>
                                            </div>
                                        </div>
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <h6 class="text-muted mb-2">Optimal Harvest Window</h6>
                                                <h5 class="mb-1" id="harvestWindow">Oct 15-25</h5>
                                                <small class="text-muted">Based on current growth rate</small>
                                            </div>
                                        </div>
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="text-muted mb-2">Yield Compared to Region</h6>
                                                <h5 class="mb-1" id="regionalComparison">+8.3%</h5>
                                                <small class="text-muted">Above regional average</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="cost" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="chart-container" style="position: relative; height: 300px;">
                                            <canvas id="costChart"></canvas>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <h6 class="text-muted mb-2">Input Cost Reduction</h6>
                                                <h3 class="mb-0" id="costReduction">7.2%</h3>
                                                <small class="text-success"><i class="bi bi-arrow-down"></i> With optimized inputs</small>
                                            </div>
                                        </div>
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <h6 class="text-muted mb-2">Labor Cost Savings</h6>
                                                <h5 class="mb-1" id="laborSavings">15%</h5>
                                                <small class="text-muted">Through efficient scheduling</small>
                                            </div>
                                        </div>
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="text-muted mb-2">ROI Improvement</h6>
                                                <h5 class="mb-1" id="roiImprovement">18.5%</h5>
                                                <small class="text-muted">Projected for this season</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="comparison" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="chart-container" style="position: relative; height: 300px;">
                                            <canvas id="comparisonChart"></canvas>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <h6 class="text-muted mb-2">Regional Rank</h6>
                                                <h3 class="mb-0" id="regionalRank">#4</h3>
                                                <small class="text-muted">Out of 27 farms in your area</small>
                                            </div>
                                        </div>
                                        <div class="card mb-3">
                                            <div class="card-body">
                                                <h6 class="text-muted mb-2">Water Efficiency</h6>
                                                <h5 class="mb-1" id="waterEfficiency">23% Better</h5>
                                                <small class="text-muted">Than regional average</small>
                                            </div>
                                        </div>
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="text-muted mb-2">Yield Gap</h6>
                                                <h5 class="mb-1" id="yieldGap">+12%</h5>
                                                <small class="text-muted">Potential to leading farms</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Button -->
    <button class="report-btn" data-bs-toggle="modal" data-bs-target="#reportModal">
        <i class="bi bi-plus-lg"></i>
    </button>

    <!-- Report Modal -->
    <div class="modal fade" id="reportModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-cloud-upload me-2"></i> Submit Field Report</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info mb-3">
                        <i class="bi bi-info-circle me-2"></i> Your report helps improve predictions for all farmers. Please be accurate and detailed.
                    </div>
                    
                    <form id="fieldReportForm">
                        <div class="mb-3">
                            <label class="form-label">Report Type <span class="text-danger">*</span></label>
                            <select class="form-select" id="reportType" required>
                                <option value="">Select report type...</option>
                                <option value="growth">Crop Growth</option>
                                <option value="pest">Pest/Disease</option>
                                <option value="soil">Soil Condition</option>
                                <option value="weather">Weather Impact</option>
                                <option value="harvest">Harvest Data</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Crop <span class="text-danger">*</span></label>
                            <select class="form-select" id="reportCrop" required>
                                <option value="">Select crop...</option>
                                <option value="rice">Rice</option>
                                <option value="wheat">Wheat</option>
                                <option value="corn">Corn</option>
                                <option value="sugarcane">Sugarcane</option>
                                <option value="cotton">Cotton</option>
                                <option value="pulses">Pulses</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Growth Stage</label>
                            <select class="form-select" id="growthStage">
                                <option value="seedling">Seedling</option>
                                <option value="vegetative">Vegetative</option>
                                <option value="flowering">Flowering</option>
                                <option valuefruiting">Fruiting</option>
                                <option value="maturity">Maturity</option>
                                <option value="harvest">Harvest</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Description <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="reportDescription" rows="3" placeholder="Describe your observations..." required></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Yield Data (kg/acre)</label>
                            <input type="number" class="form-control" id="yieldData" placeholder="Enter yield if applicable">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Photo Evidence (Optional)</label>
                            <input type="file" class="form-control" id="reportPhoto" accept="image/*">
                            <div id="imagePreview" class="mt-2"></div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Your Name (Optional)</label>
                            <input type="text" class="form-control" id="reporterName" placeholder="Farmer Name">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Location</label>
                            <div class="alert alert-info py-2">
                                <i class="bi bi-geo-alt me-2"></i> <span id="locationStatus">Detecting your location...</span>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary" id="submitReportBtn">
                                <span class="spinner-border spinner-border-sm me-2" id="submitSpinner" style="display: none;"></span>
                                <i class="bi bi-send me-2"></i> Submit Report
                            </button>
                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-5 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-4 mb-lg-0">
                    <h5 class="d-flex align-items-center mb-3">
                        <i class="bi bi-cloud-sun-fill me-2"></i>
                        <span class="agripredict-brand">AgriPredict</span>
                    </h5>
                    <p class="text-muted">AI-powered crop yield prediction and optimization for modern farmers.</p>
                    <div class="d-flex gap-3 mt-3">
                        <a href="#" class="text-muted"><i class="bi bi-twitter"></i></a>
                        <a href="#" class="text-muted"><i class="bi bi-facebook"></i></a>
                        <a href="#" class="text-muted"><i class="bi bi-github"></i></a>
                    </div>
                </div>
                <div class="col-lg-2 col-md-4 mb-4 mb-md-0">
                    <h6>Navigation</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="#map" class="text-muted">Field Map</a></li>
                        <li class="mb-2"><a href="#predict" class="text-muted">Yield Prediction</a></li>
                        <li class="mb-2"><a href="#reports" class="text-muted">Reports</a></li>
                        <li class="mb-2"><a href="#analytics" class="text-muted">Analytics</a></li>
                        <li><a href="#optimization" class="text-muted">Optimization</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-md-4 mb-4 mb-md-0">
                    <h6>Resources</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="#" class="text-muted">Farmer's Guide</a></li>
                        <li class="mb-2"><a href="#" class="text-muted">Crop Library</a></li>
                        <li class="mb-2"><a href="#" class="text-muted">API Docs</a></li>
                        <li><a href="#" class="text-muted">Privacy Policy</a></li>
                    </ul>
                </div>
                <div class="col-lg-4 col-md-4">
                    <h6>Subscribe to Updates</h6>
                    <p class="text-muted small">Get the latest farming insights and platform updates.</p>
                    <form class="mt-3">
                        <div class="input-group mb-3">
                            <input type="email" class="form-control" placeholder="Your email" aria-label="Your email">
                            <button class="btn btn-primary" type="button">Subscribe</button>
                        </div>
                    </form>
                </div>
            </div>
            <hr class="my-4 bg-secondary">
            <div class="text-center">
                <small class="text-muted">&copy; 2025 AgriPredict. Developed for the Government of Odisha's Agriculture Innovation Challenge.</small>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Configuration
        const OPENWEATHER_API_KEY = 'b41ebce0340aaa233ed0433f4b17023b'; // Replace with your actual API key
        const GOOGLE_SHEETS_WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbza5S5-REtVvOH8GQWuqGysymxcTrcpBcI_3tPNCTzyv9I792En0DT3n3AfYYoxxZZX/exec'; // Replace with your deployed Google Apps Script URL
        
        // Global variables
        let weatherMap;
        let userLocation = null;
        let yieldChart, costChart, comparisonChart;
        let currentReports = [];
        let currentCrop = 'rice';
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the map
            initMap();
            
            // Set up event listeners
            setupEventListeners();
            
            // Get user's location and load weather data
            getUserLocation();
            
            // Load community reports
            loadCommunityReports();
            
            // Initialize analytics charts
            initAnalyticsCharts();
            
            // Set up crop selection
            setupCropSelection();
            
            // Set up language selector
            document.getElementById('languageSelector').addEventListener('change', function(e) {
                // In a real implementation, this would change the UI language
                alert('Language changed to ' + e.target.options[e.target.selectedIndex].text);
            });
        });
        
        function initMap() {
            // Create the map centered on a default location
            weatherMap = L.map('weatherMap').setView([20.9517, 85.0985], 10); // Default to Odisha coordinates
            
            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(weatherMap);
        }
        
        function setupEventListeners() {
            // Refresh reports button
            document.getElementById('refreshReportsBtn').addEventListener('click', loadCommunityReports);
            
            // Locate me button
            document.getElementById('locateMeBtn').addEventListener('click', centerMapOnUser);
            
            // Refresh map button
            document.getElementById('refreshMapBtn').addEventListener('click', refreshMapData);
            
            // Load more reports button
            document.getElementById('loadMoreReportsBtn').addEventListener('click', loadMoreReports);
            
            // Report form submission
            document.getElementById('fieldReportForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitFieldReport();
            });
            
            // Image upload preview
            document.getElementById('reportPhoto').addEventListener('change', function(e) {
                previewImage(e.target);
            });
            
            // Modal shown event to update location status
            document.getElementById('reportModal').addEventListener('shown.bs.modal', function() {
                updateLocationStatus();
            });
            
            // Predict yield button
            document.getElementById('predictYieldBtn').addEventListener('click', predictYield);
        }
        
        function setupCropSelection() {
            const cropOptions = document.querySelectorAll('.crop-option');
            cropOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Remove active class from all options
                    cropOptions.forEach(opt => opt.classList.remove('active'));
                    
                    // Add active class to clicked option
                    this.classList.add('active');
                    
                    // Update current crop
                    currentCrop = this.getAttribute('data-crop');
                    document.getElementById('selectedCrop').textContent = currentCrop.charAt(0).toUpperCase() + currentCrop.slice(1);
                    
                    // Update prediction
                    predictYield();
                });
            });
        }
        
        function predictYield() {
            const fieldArea = parseFloat(document.getElementById('fieldArea').value) || 5;
            const soilType = document.getElementById('soilType').value;
            const irrigationType = document.getElementById('irrigationType').value;
            
            // Simulate AI prediction based on inputs
            let baseYield;
            switch(currentCrop) {
                case 'rice': baseYield = 4.2; break;
                case 'wheat': baseYield = 3.8; break;
                case 'corn': baseYield = 5.1; break;
                case 'sugarcane': baseYield = 72; break; // tons per acre
                case 'cotton': baseYield = 1.8; break; // bales per acre
                case 'pulses': baseYield = 1.2; break;
                default: baseYield = 4.0;
            }
            
            // Adjust based on soil type
            let soilMultiplier = 1.0;
            switch(soilType) {
                case 'loamy': soilMultiplier = 1.15; break;
                case 'clay': soilMultiplier = 0.9; break;
                case 'sandy': soilMultiplier = 0.8; break;
                case 'silt': soilMultiplier = 1.05; break;
            }
            
            // Adjust based on irrigation
            let irrigationMultiplier = 1.0;
            switch(irrigationType) {
                case 'drip': irrigationMultiplier = 1.2; break;
                case 'sprinkler': irrigationMultiplier = 1.1; break;
                case 'flood': irrigationMultiplier = 0.95; break;
                case 'rainfed': irrigationMultiplier = 0.85; break;
            }
            
            // Calculate final yield
            const predictedYield = baseYield * soilMultiplier * irrigationMultiplier;
            
            // Update UI
            const yieldUnit = currentCrop === 'sugarcane' ? 'tons' : (currentCrop === 'cotton' ? 'bales' : 'tons');
            document.getElementById('yieldValue').textContent = predictedYield.toFixed(1) + ' ' + yieldUnit + '/acre';
            document.getElementById('totalYield').textContent = (predictedYield * fieldArea).toFixed(1) + ' ' + yieldUnit;
            
            // Calculate expected revenue (simplified)
            let pricePerUnit;
            switch(currentCrop) {
                case 'rice': pricePerUnit = 2500; break;
                case 'wheat': pricePerUnit = 2200; break;
                case 'corn': pricePerUnit = 1800; break;
                case 'sugarcane': pricePerUnit = 350; break; // per ton
                case 'cotton': pricePerUnit = 6000; break; // per bale
                case 'pulses': pricePerUnit = 7000; break; // per ton
                default: pricePerUnit = 2000;
            }
            
            const expectedRevenue = predictedYield * fieldArea * pricePerUnit;
            document.getElementById('expectedRevenue').textContent = '₹' + expectedRevenue.toLocaleString('en-IN');
            
            // Update yield meter
            document.querySelector('.yield-fill').style.width = (predictedYield / 6 * 100) + '%';
            
            // Add animation for visual feedback
            const yieldResult = document.querySelector('.prediction-result');
            yieldResult.classList.add('pulse-animation');
            setTimeout(() => {
                yieldResult.classList.remove('pulse-animation');
            }, 1000);
        }
        
        function getUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        
                        // Update the map view
                        weatherMap.setView([userLocation.lat, userLocation.lng], 13);
                        
                        // Add a marker for the user's location
                        L.marker([userLocation.lat, userLocation.lng], {
                            icon: L.divIcon({
                                className: 'user-location-marker',
                                html: '<i class="bi bi-geo-alt-fill" style="color: #e74c3c; font-size: 24px;"></i>',
                                iconSize: [24, 24],
                                iconAnchor: [12, 24]
                            })
                        }).addTo(weatherMap)
                            .bindPopup('Your Location')
                            .openPopup();
                        
                        // Load weather data for this location
                        loadWeatherData(userLocation.lat, userLocation.lng);
                        
                        // Update location status in report modal
                        updateLocationStatus();
                    },
                    function(error) {
                        console.error('Error getting location:', error);
                        // Default to Odisha location if geolocation fails
                        userLocation = { lat: 20.9517, lng: 85.0985 };
                        loadWeatherData(userLocation.lat, userLocation.lng);
                        
                        // Update location status in report modal
                        document.getElementById('locationStatus').textContent = 'Using default location (enable location services for better accuracy)';
                    }
                );
            } else {
                console.log('Geolocation is not supported by this browser.');
                // Default to Odisha location
                userLocation = { lat: 20.9517, lng: 85.0985 };
                loadWeatherData(userLocation.lat, userLocation.lng);
                
                // Update location status in report modal
                document.getElementById('locationStatus').textContent = 'Location services not supported by your browser';
            }
        }
        
        function updateLocationStatus() {
            if (!userLocation) {
                document.getElementById('locationStatus').textContent = 'Detecting your location...';
                return;
            }
            
            // Display coordinates
            document.getElementById('locationStatus').innerHTML = `
                <i class="bi bi-check-circle-fill text-success me-2"></i>
                Location detected: ${userLocation.lat.toFixed(4)}, ${userLocation.lng.toFixed(4)}
            `;
        }
        
        function centerMapOnUser() {
            if (userLocation) {
                weatherMap.setView([userLocation.lat, userLocation.lng], 13);
            } else {
                alert('Location not available. Please ensure location services are enabled.');
            }
        }
        
        function refreshMapData() {
            if (userLocation) {
                loadWeatherData(userLocation.lat, userLocation.lng);
                loadCommunityReports();
                
                // Show feedback
                const btn = document.getElementById('refreshMapBtn');
                const originalHtml = btn.innerHTML;
                btn.innerHTML = '<i class="bi bi-check2"></i> Updated';
                btn.classList.remove('btn-outline-primary');
                btn.classList.add('btn-success');
                
                setTimeout(() => {
                    btn.innerHTML = originalHtml;
                    btn.classList.remove('btn-success');
                    btn.classList.add('btn-outline-primary');
                }, 2000);
            }
        }
        
        function loadWeatherData(lat, lng) {
            // Update last updated time
            document.getElementById('lastUpdated').textContent = `Updated: ${new Date().toLocaleTimeString()}`;
            
            // Update location text
            document.getElementById('locationText').textContent = `Near ${lat.toFixed(2)}, ${lng.toFixed(2)}`;
            
            // Fetch current weather
            fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lng}&units=metric&appid=${OPENWEATHER_API_KEY}`)
                .then(response => response.json())
                .then(data => {
                    displayCurrentWeather(data);
                })
                .catch(error => {
                    console.error('Error fetching weather data:', error);
                    document.getElementById('weatherDescription').textContent = 'Weather data unavailable';
                });
            
            // Fetch forecast
            fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lng}&units=metric&appid=${OPENWEATHER_API_KEY}`)
                .then(response => response.json())
                .then(data => {
                    displayWeatherForecast(data);
                })
                .catch(error => {
                    console.error('Error fetching forecast data:', error);
                });
            
            // Simulate soil data (in a real app, this would come from IoT sensors or satellite data)
            simulateSoilData();
        }
        
        function simulateSoilData() {
            // Generate random soil data for demonstration
            document.getElementById('soilMoisture').textContent = Math.floor(Math.random() * 30 + 40) + '%';
            document.getElementById('soilTemp').textContent = Math.floor(Math.random() * 10 + 22) + '°C';
        }
        
        function displayCurrentWeather(data) {
            document.getElementById('currentTemp').textContent = `${Math.round(data.main.temp)}°C`;
            document.getElementById('weatherDescription').textContent = data.weather[0].description;
            document.getElementById('humidity').textContent = `${data.main.humidity}%`;
            document.getElementById('windSpeed').textContent = `${Math.round(data.wind.speed * 3.6)} km/h`;
            
            // Set weather icon
            const iconUrl = `https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png`;
            document.getElementById('weatherIcon').src = iconUrl;
            document.getElementById('weatherIcon').alt = data.weather[0].description;
            
            // Convert sunrise/sunset times
            const sunriseTime = new Date(data.sys.sunrise * 1000);
            const sunsetTime = new Date(data.sys.sunset * 1000);
            
            document.getElementById('sunrise').textContent = sunriseTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            document.getElementById('sunset').textContent = sunsetTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }
        
        function displayWeatherForecast(data) {
            const forecastTable = document.getElementById('forecastTable').querySelector('tbody');
            forecastTable.innerHTML = '';
            
            // Show one forecast per day (every 8th item in the 3-hour forecast)
            for (let i = 0; i < data.list.length; i += 8) {
                const forecast = data.list[i];
                const forecastDate = new Date(forecast.dt * 1000);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="width: 120px;">
                        <strong>${forecastDate.toLocaleDateString([], { weekday: 'short' })}</strong>
                        <div class="text-muted small">${forecastDate.toLocaleDateString([], { month: 'short', day: 'numeric' })}</div>
                    </td>
                    <td class="text-center">
                        <img src="https://openweathermap.org/img/wn/${forecast.weather[0].icon}.png" alt="${forecast.weather[0].description}" title="${forecast.weather[0].description}">
                    </td>
                    <td class="text-end">${Math.round(forecast.main.temp_max)}°C</td>
                    <td class="text-end">${Math.round(forecast.main.temp_min)}°C</td>
                    <td class="text-end">${forecast.pop > 0 ? Math.round(forecast.pop * 100) + '%' : '0%'}</td>
                `;
                
                forecastTable.appendChild(row);
            }
        }
        
        function loadCommunityReports() {
            const reportsList = document.getElementById('reportsList');
            const loadingElement = document.getElementById('reportsLoading');
            
            // Show loading state
            reportsList.innerHTML = '';
            loadingElement.style.display = 'block';
            document.getElementById('loadMoreReportsBtn').style.display = 'none';
            
            // In a real implementation, this would fetch from your backend
            setTimeout(() => {
                currentReports = generateMockReports();
                
                // Clear existing markers except user location
                weatherMap.eachLayer(layer => {
                    if (layer instanceof L.Marker || layer instanceof L.CircleMarker) {
                        if (!layer.options.className || layer.options.className !== 'user-location-marker') {
                            weatherMap.removeLayer(layer);
                        }
                    }
                });
                
                // Display first 5 reports
                displayReports(currentReports.slice(0, 5));
                
                // Hide loading state
                loadingElement.style.display = 'none';
                
                // Show load more button if there are more reports
                if (currentReports.length > 5) {
                    document.getElementById('loadMoreReportsBtn').style.display = 'inline-block';
                }
            }, 1000);
        }
        
        function loadMoreReports() {
            const reportsList = document.getElementById('reportsList');
            const currentlyDisplayed = reportsList.children.length;
            
            // Display next 5 reports
            displayReports(currentReports.slice(currentlyDisplayed, currentlyDisplayed + 5));
            
            // Hide load more button if we've shown all reports
            if (reportsList.children.length >= currentReports.length) {
                document.getElementById('loadMoreReportsBtn').style.display = 'none';
            }
        }
        
        function displayReports(reports) {
            const reportsList = document.getElementById('reportsList');
            
            reports.forEach(report => {
                // Add to list
                const reportElement = document.createElement('a');
                reportElement.href = '#';
                reportElement.className = 'list-group-item list-group-item-action';
                
                let severityClass = '';
                let severityIcon = '';
                let severityText = '';
                
                switch(report.severity) {
                    case 'low':
                        severityClass = 'severity-low';
                        severityIcon = 'bi-exclamation-circle text-success';
                        severityText = 'Low Severity';
                        break;
                    case 'medium':
                        severityClass = 'severity-medium';
                        severityIcon = 'bi-exclamation-triangle text-warning';
                        severityText = 'Medium Severity';
                        break;
                    case 'high':
                        severityClass = 'severity-high';
                        severityIcon = 'bi-exclamation-octagon text-danger';
                        severityText = 'High Severity';
                        break;
                }
                
                const reportDate = new Date(report.date);
                const timeAgo = getTimeAgo(reportDate);
                
                reportElement.innerHTML = `
                    <div class="d-flex w-100 justify-content-between ${severityClass}">
                        <div>
                            <div class="d-flex align-items-center mb-1">
                                <h6 class="mb-0 text-capitalize">${report.type}</h6>
                                <span class="badge bg-light text-dark ms-2"><i class="bi ${severityIcon} me-1"></i> ${severityText}</span>
                            </div>
                            <p class="mb-1">${report.description}</p>
                            ${report.image ? `<img src="${report.image}" class="preview-image mb-2" style="max-width: 150px;">` : ''}
                            <small class="text-muted">Reported by ${report.reporter}</small>
                        </div>
                        <div class="text-end">
                            <small class="text-muted d-block">${timeAgo}</small>
                            <small class="text-muted d-block">${report.distance} km away</small>
                        </div>
                    </div>
                `;
                
                reportsList.appendChild(reportElement);
                
                // Add to map
                let markerColor;
                switch(report.type) {
                    case 'growth': markerColor = '#2ecc71'; break;
                    case 'pest': markerColor = '#e74c3c'; break;
                    case 'soil': markerColor = '#f39c12'; break;
                    case 'weather': markerColor = '#3498db'; break;
                    case 'harvest': markerColor = '#9b59b6'; break;
                    default: markerColor = '#34495e';
                }
                
                const marker = L.circleMarker([report.lat, report.lng], {
                    radius: 8,
                    fillColor: markerColor,
                    color: '#fff',
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8
                }).addTo(weatherMap);
                
                let popupContent = `
                    <b>${report.type.toUpperCase()} REPORT</b><br>
                    <small>${reportDate.toLocaleString()}</small><br><br>
                    <i>${report.description}</i><br><br>
                    <small>Severity: ${report.severity}</small><br>
                    <small>Reported by: ${report.reporter}</small>
                `;
                
                if (report.image) {
                    popupContent += `<br><img src="${report.image}" style="max-width: 150px; margin-top: 10px;">`;
                }
                
                marker.bindPopup(popupContent);
            });
        }
        
        function generateMockReports() {
            if (!userLocation) return [];
            
            const reportTypes = ['growth', 'pest', 'soil', 'weather', 'harvest'];
            const reporters = ['Farm Fresh Co.', 'River Valley Farms', 'Sunny Acres', 'Green Thumb Nursery', 'Organic Valley', 'Heritage Farms'];
            const severities = ['low', 'medium', 'high'];
            const descriptions = [
                'Rice plants at flowering stage, looking healthy',
                'Found brown plant hopper infestation in northwest corner of field',
                'Soil pH testing at 6.8, ideal for current crop',
                'Heavy rains caused some waterlogging in low-lying areas',
                'Harvested first batch of wheat, yield better than expected',
                'Corn plants showing signs of nitrogen deficiency'
            ];
            
            const mockImages = [
                'https://images.unsplash.com/photo-1518604666860-9ed391f76460?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80',
                'https://images.unsplash.com/photo-1560264281-4b7b7d872f58?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80',
                'https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80'
            ];
            
            const mockReports = [];
            const now = new Date();
            
            for (let i = 0; i < 15; i++) {
                const type = reportTypes[Math.floor(Math.random() * reportTypes.length)];
                const severity = severities[Math.floor(Math.random() * severities.length)];
                const reporter = reporters[Math.floor(Math.random() * reporters.length)];
                const description = descriptions[Math.floor(Math.random() * descriptions.length)];
                
                // Generate random location near user (within 50km)
                const lat = userLocation.lat + (Math.random() * 0.5 - 0.25);
                const lng = userLocation.lng + (Math.random() * 0.5 - 0.25);
                
                // Calculate distance from user
                const distance = calculateDistance(userLocation.lat, userLocation.lng, lat, lng);
                
                // Random date in past 7 days
                const date = new Date(now - Math.random() * 7 * 24 * 60 * 60 * 1000);
                
                mockReports.push({
                    id: i + 1,
                    type,
                    severity,
                    description,
                    reporter,
                    date: date.toISOString(),
                    lat,
                    lng,
                    distance: distance.toFixed(1),
                    image: Math.random() > 0.7 ? mockImages[Math.floor(Math.random() * mockImages.length)] : null
                });
            }
            
            // Sort by date (newest first)
            return mockReports.sort((a, b) => new Date(b.date) - new Date(a.date));
        }
        
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radius of the earth in km
            const dLat = deg2rad(lat2 - lat1);
            const dLon = deg2rad(lon2 - lon1); 
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * 
                Math.sin(dLon/2) * Math.sin(dLon/2); 
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
            return R * c; // Distance in km
        }
        
        function deg2rad(deg) {
            return deg * (Math.PI/180);
        }
        
        function submitFieldReport() {
            if (!userLocation) {
                alert('Please enable location services to submit a report.');
                return;
            }
            
            const submitBtn = document.getElementById('submitReportBtn');
            const spinner = document.getElementById('submitSpinner');
            const form = document.getElementById('fieldReportForm');
            
            // Show loading state
            submitBtn.disabled = true;
            spinner.style.display = 'inline-block';
            
            // Get form data
            const reportData = {
                type: document.getElementById('reportType').value,
                crop: document.getElementById('reportCrop').value,
                growthStage: document.getElementById('growthStage').value,
                description: document.getElementById('reportDescription').value,
                yieldData: document.getElementById('yieldData').value,
                reporter: document.getElementById('reporterName').value || 'Anonymous',
                lat: userLocation.lat,
                lng: userLocation.lng,
                timestamp: new Date().toISOString()
            };
            
            // Handle image upload if present
            const imageInput = document.getElementById('reportPhoto');
            let imageFile = null;
            
            if (imageInput.files.length > 0) {
                imageFile = imageInput.files[0];
                // In a real implementation, you would upload this to your server
                reportData.image = 'https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80';
            }
            
            // In a real implementation, this would POST to your backend
            console.log('Submitting report:', reportData);
            
            // Simulate API call delay for demo
            setTimeout(() => {
                // Hide loading state
                submitBtn.disabled = false;
                spinner.style.display = 'none';
                
                // Show success message
                alert('Thank you for your report! This helps improve predictions for all farmers.');
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('reportModal'));
                modal.hide();
                
                // Refresh reports
                loadCommunityReports();
                
                // Reset form
                form.reset();
                document.getElementById('imagePreview').innerHTML = '';
            }, 1500);
        }
        
        function previewImage(input) {
            const previewContainer = document.getElementById('imagePreview');
            previewContainer.innerHTML = '';
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const previewDiv = document.createElement('div');
                    previewDiv.className = 'image-preview-container';
                    previewDiv.innerHTML = `
                        <img src="${e.target.result}" class="preview-image">
                        <button type="button" class="remove-image-btn" onclick="removeImagePreview()">
                            <i class="bi bi-x"></i>
                        </button>
                    `;
                    previewContainer.appendChild(previewDiv);
                };
                
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        function removeImagePreview() {
            document.getElementById('reportPhoto').value = '';
            document.getElementById('imagePreview').innerHTML = '';
        }
        
        function initAnalyticsCharts() {
            // Yield Trends Chart
            const yieldCtx = document.getElementById('yieldChart').getContext('2d');
            yieldChart = new Chart(yieldCtx, {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6', 'Week 7'],
                    datasets: [{
                        label: 'Your Yield Projection',
                        data: [2.1, 2.8, 3.5, 4.0, 4.3, 4.5, 4.7],
                        borderColor: '#2c5aa0',
                        backgroundColor: 'rgba(44, 90, 160, 0.1)',
                        fill: true,
                        tension: 0.3
                    }, {
                        label: 'Regional Average',
                        data: [2.0, 2.5, 3.0, 3.4, 3.7, 3.9, 4.1],
                        borderColor: '#4caf50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        fill: true,
                        tension: 0.3,
                        borderDash: [5, 5]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Yield Projection (tons/acre)'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Tons per Acre'
                            }
                        }
                    }
                }
            });
            
            // Cost Analysis Chart
            const costCtx = document.getElementById('costChart').getContext('2d');
            costChart = new Chart(costCtx, {
                type: 'bar',
                data: {
                    labels: ['Seeds', 'Fertilizer', 'Pesticides', 'Labor', 'Water', 'Equipment'],
                    datasets: [{
                        label: 'Current Costs',
                        data: [12000, 18000, 8000, 25000, 5000, 15000],
                        backgroundColor: 'rgba(44, 90, 160, 0.7)'
                    }, {
                        label: 'Optimized Costs',
                        data: [12000, 15000, 6000, 22000, 3500, 15000],
                        backgroundColor: 'rgba(76, 175, 80, 0.7)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Cost Analysis (₹)'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Cost in ₹'
                            }
                        }
                    }
                }
            });
            
            // Regional Comparison Chart
            const comparisonCtx = document.getElementById('comparisonChart').getContext('2d');
            comparisonChart = new Chart(comparisonCtx, {
                type: 'radar',
                data: {
                    labels: ['Yield', 'Water Efficiency', 'Cost Control', 'Soil Health', 'Crop Quality'],
                    datasets: [{
                        label: 'Your Farm',
                        data: [85, 90, 75, 80, 85],
                        backgroundColor: 'rgba(44, 90, 160, 0.2)',
                        borderColor: '#2c5aa0',
                        pointBackgroundColor: '#2c5aa0'
                    }, {
                        label: 'Regional Average',
                        data: [70, 65, 60, 75, 70],
                        backgroundColor: 'rgba(76, 175, 80, 0.2)',
                        borderColor: '#4caf50',
                        pointBackgroundColor: '#4caf50'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Regional Comparison (%)'
                        }
                    },
                    scales: {
                        r: {
                            angleLines: {
                                display: true
                            },
                            suggestedMin: 0,
                            suggestedMax: 100
                        }
                    }
                }
            });
        }
        
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            let interval = Math.floor(seconds / 31536000);
            if (interval >= 1) return `${interval} year${interval === 1 ? '' : 's'} ago`;
            
            interval = Math.floor(seconds / 2592000);
            if (interval >= 1) return `${interval} month${interval === 1 ? '' : 's'} ago`;
            
            interval = Math.floor(seconds / 86400);
            if (interval >= 1) return `${interval} day${interval === 1 ? '' : 's'} ago`;
            
            interval = Math.floor(seconds / 3600);
            if (interval >= 1) return `${interval} hour${interval === 1 ? '' : 's'} ago`;
            
            interval = Math.floor(seconds / 60);
            if (interval >= 1) return `${interval} minute${interval === 1 ? '' : 's'} ago`;
            
            return 'Just now';
        }
        
        // Make removeImagePreview available globally
        window.removeImagePreview = removeImagePreview;
    </script>
</body>
</html>
